<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="login.page_title">Login - Student Dashboard</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="login-page">
    <div class="login-wrapper">
      <div class="login-promo">
        <div class="promo-content">
          <div class="promo-logo">*</div>
          <h1 data-i18n="login.title">Halo, Selamat Datang!</h1>
          <p data-i18n="login.subtitle">
            Masuk untuk mengakses dashboard akademik Anda di UCIC.
          </p>
          <div class="promo-footer">
            <p>Â© 2024 UCIC. All rights reserved.</p>
          </div>
        </div>
      </div>

      <div class="login-form-container">
        <div class="form-wrapper">
          <h3 class="form-logo-text">ðŸŽ“ Dashboard Mahasiswa</h3>
          <h2 data-i18n="login.welcome">Selamat Datang Kembali</h2>

          <form class="login-form" id="loginForm">
            <div class="form-group">
              <label for="email" data-i18n="login.email">Email</label>
              <input
                type="email"
                id="email"
                placeholder="Masukan Email"
                required
              />
            </div>
            <div class="form-group">
              <label for="password" data-i18n="login.password">Password</label>
              <input
                type="password"
                id="password"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                required
              />
            </div>

            <div class="form-options">
              <a href="#" data-i18n="login.forgot">Lupa password?</a>
            </div>

            <button type="submit" data-i18n="login.button">Masuk</button>
            <div class="login-footer-desktop">
              <p>
                <span data-i18n="login.no_account">Belum punya akun?</span>
                <a href="register.html" data-i18n="login.register_now"
                  >Daftar sekarang</a
                >
              </p>
            </div>
          </form>

          <div class="login-footer-mobile" id="login-footer-mobile">
            <p>
              <span data-i18n="login.no_account">Belum punya akun?</span>
              <a href="register.html" data-i18n="login.register_now"
                >Daftar sekarang</a
              >
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Fungsi untuk HASH password (Wajib untuk verifikasi yang aman)
      async function hashPassword(password) {
        const encoder = new TextEncoder();
        const data = encoder.encode(password);
        const hashBuffer = await crypto.subtle.digest("SHA-256", data);
        const hashHex = Array.from(new Uint8Array(hashBuffer))
          .map((b) => b.toString(16).padStart(2, "0"))
          .join("");
        return hashHex;
      }

      // === LOGIKA LOGIN & TRANSLATION ===
      const translations = {
        en: {
          "login.page_title": "Login - Student Dashboard",
          "login.title": "Hello, Welcome!",
          "login.subtitle":
            "Sign in to access your academic dashboard at UCIC.",
          "login.welcome": "Welcome Back",
          "login.no_account": "Don't have an account?",
          "login.register_now": "Register now",
          "login.email": "Email",
          "login.password": "Password",
          "login.forgot": "Forgot password?",
          "login.button": "Sign In",
        },
        id: {
          "login.page_title": "Masuk - Dashboard Mahasiswa",
          "login.title": "Halo, Selamat Datang!",
          "login.subtitle":
            "Masuk untuk mengakses dashboard akademik Anda di UCIC.",
          "login.welcome": "Selamat Datang Kembali",
          "login.no_account": "Belum punya akun?",
          "login.register_now": "Daftar sekarang",
          "login.email": "Email",
          "login.password": "Password",
          "login.forgot": "Lupa password?",
          "login.button": "Masuk",
        },
      };

      let currentLanguage = "id"; // Default

      function applyTranslations() {
        const elements = document.querySelectorAll("[data-i18n]");
        elements.forEach((element) => {
          const key = element.getAttribute("data-i18n");
          if (translations[currentLanguage][key]) {
            element.textContent = translations[currentLanguage][key];
          }
        });
        document.title = translations[currentLanguage]["login.page_title"];
      }

      document.addEventListener("DOMContentLoaded", function () {
        // 1. Cek apakah user sudah login. Jika iya, langsung redirect
        if (localStorage.getItem("isLoggedIn") === "true") {
          window.location.href = "dashboard.html";
          return;
        }

        // 2. Cek bahasa dari dashboard
        const savedLanguage = localStorage.getItem("preferredLanguage");
        if (savedLanguage && translations[savedLanguage]) {
          currentLanguage = savedLanguage;
        }
        applyTranslations();

        // 3. Logika submit form: Verifikasi dan Login
        document
          .getElementById("loginForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            let users = JSON.parse(localStorage.getItem("users") || "[]");
            const user = users.find((u) => u.email === email);

            if (!user) {
              alert(
                currentLanguage === "id"
                  ? "Email tidak terdaftar."
                  : "Email not found."
              );
              return;
            }

            // Hash password yang dimasukkan dan bandingkan
            const inputHash = await hashPassword(password);

            if (inputHash === user.passwordHash) {
              // LOGIN BERHASIL: Simpan status login dan data user ke localStorage
              localStorage.setItem("isLoggedIn", "true");
              localStorage.setItem("currentUser", JSON.stringify(user));

              // Simpan bahasa saat login
              localStorage.setItem("preferredLanguage", currentLanguage);

              alert(
                currentLanguage === "id"
                  ? "Login berhasil!"
                  : "Login successful!"
              );
              window.location.href = "dashboard.html";
            } else {
              alert(
                currentLanguage === "id"
                  ? "Password salah."
                  : "Incorrect password."
              );
            }
          });
      });
    </script>
  </body>
</html>
